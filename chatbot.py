import re
import random

# پایگاه داده ساده برای پاسخ‌های چت‌بات
responses = {
    'سلام': ['سلام!', 'درود!', 'چه خوب که می‌بینمت!', 'سلام دوست عزیز!'],
    'خوبی': ['ممنون، خوبم. شما چطور؟', 'عالی! امیدوارم شما هم خوب باشید.', 'خوبم، ممنون.'],
    'اسمت چیه': ['من یک چت‌بات هستم.', 'اسم من بات است.', 'من بات هستم.'],
    'خداحافظ': ['خداحافظ!', 'موفق باشی!', 'تا بعد!', 'مراقب خودت باش!'],
    'چه خبر': ['سلامتی!', 'همه چیز خوبه.', 'خبری نیست.', 'همه چیز عالیه!'],
    'تو کی هستی': ['من یک برنامه کامپیوتری هستم.', 'من یک هوش مصنوعی هستم.', 'من یک ربات هستم.'],
    'ممنون': ['خواهش می‌کنم!', 'سلامتی!', 'خوشحال شدم.', 'خواهش نمی‌کنم.'],
    'ببخشید': ['ببخشید؟', 'مشکلی نیست.', ' مهم نیست.'],
    'چطوری': ['خوبم، ممنون. شما چطور؟', 'عالی! امیدوارم شما هم خوب باشید.', 'خوبم!'],
    'چه کار می‌کنی': ['با شما چت می‌کنم!', 'در حال گفتگو با شما هستم.', 'منتظر صحبت با شما هستم.'],
    'عمرش چنده': ['من یک برنامه کامپیوتری هستم، پس عمر معمولی ندارم.', 'من تازه ساخته شدم!'],
    'دوستت دارم': ['من هم شما را دوست دارم!', 'ممنون، این حرف شما را خوشم آمد.'],
    'چی بلدی': ['می‌تونم با شما چت کنم و به سوالاتتون پاسخ بدم.', 'می‌تونم چندتا کار ساده انجام بدم.'],
    'هوش مصنوعی هستی': ['بله، من یک هوش مصنوعی ساده هستم.', 'بله، یک ربات هستم.'],
    'تاریخ': ['امروز تاریخ خوبی برای گفتگوست!', 'تاریخ برای من مهم نیست، مهم اینه که باهام صحبت کنید.'],
    'ساعت': ['من ساعت نمی‌دونم، ولی وقت خوبی برای گفتگوست!', 'ساعت برای من مهم نیست.'],
    'کمک': ['چطور می‌تونم کمکتون کنم؟', 'می‌تونید سوالاتتون رو از من بپرسید.'],
    'آب و هوا': ['من نمی‌تونم آب و هوا رو چک کنم، ولی امیدوارم هوا خوب باشه!'],
    'خبر': ['من خبر خاصی ندارم، ولی خوشحالم که باهام صحبت می‌کنید.']
}

# ذخیره سازی یادگیری‌های جدید
learned_responses = {}

def get_response(user_input):
    # حذف فاصله‌های اضافی و تبدیل به حروف کوچک
    user_input = user_input.strip()
    
    # اگر ورودی خالی باشد
    if not user_input:
        return "لطفاً یک پیام بنویسید."
    
    # بررسی در پاسخ‌های یادگیری شده
    if user_input in learned_responses:
        return learned_responses[user_input]
    
    # بررسی در پاسخ‌های از پیش تعریف شده
    for key in responses:
        if re.search(r'\b' + re.escape(key) + r'\b', user_input, re.IGNORECASE):
            return random.choice(responses[key])
    
    # پاسخ‌های عمومی
    general_responses = [
        "این یک چت‌بات ساده است. می‌توانید سوالات ساده‌تری بپرسید.",
        "من یک چت‌بات محلی هستم و به سوالات ساده پاسخ می‌دهم.",
        "ممنون از پیام شما. آیا سوال دیگری دارید؟",
        "من فقط می‌توانم به چند سوال ساده پاسخ دهم.",
        "سوال جالبی بود! ولی من ممکن است نتونم بهتر از این پاسخ بدم."
    ]
    
    return random.choice(general_responses)

def learn_new_response(user_input):
    print(f"من نمی‌دانم چگونه به '{user_input}' پاسخ دهم.")
    response = input("لطفاً یک پاسخ مناسب وارد کنید (یا 'رد' برای رد کردن): ")
    
    if response != 'رد':
        learned_responses[user_input] = response
        print("ممنون! من این پاسخ را یادداشت کردم.")
        return "ممنون! من این پاسخ را یادداشت کردم. می‌توانید دوباره سوال کنید."
    else:
        return "خب، ادامه می‌دهیم..."

def main():
    print("=" * 50)
    print("سلام! من یک چت‌بات هستم.")
    print("با من صحبت کنید! (برای خروج 'خروج' را تایپ کنید)")
    print("=" * 50)
    
    while True:
        try:
            user_input = input("\nشما: ").strip()
            
            if not user_input:
                print("بات: لطفاً یک پیام بنویسید.")
                continue
            
            if user_input.lower() in ['خروج', 'exit', 'quit']:
                print("بات: خداحافظ! ممنون که با من صحبت کردید.")
                break
            
            response = get_response(user_input)
            print(f"بات: {response}")
            
        except KeyboardInterrupt:
            print("\nبات: خداحافظ! برنامه متوقف شد.")
            break
        except Exception as e:
            print(f"بات: متاسفانه خطایی رخ داده است: {e}")

if __name__ == "__main__":
    main()